<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>011-动态水面（带倒影）</title>
    <script src="./Cesium/Cesium.js"></script>
    <link rel="stylesheet" href="./Cesium/Widgets/widgets.css" />
    <script src="./lib/larkexplorer.umd.min.js"></script>
    <script src="./dat.gui.min.js"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
      #cesiumContainer {
        width: 100%;
        height: 100%;
        position: relative;
      }
      #gui-box {
        position: absolute;
        left: 5px;
        top: 5px;
        z-index: 99;
        background: #000;
        padding: 2px;
      }
    </style>
  </head>
  <body>
    <div id="cesiumContainer">
      <div id="gui-box"></div>
    </div>
    <script>
      const { DefaultTdtImg, DefaultTerrain } = LarkExplorer.BaseLayer
      const viewer = new LarkExplorer.Viewer("cesiumContainer", {
        baseLayer: DefaultTdtImg,
        fpsShow: true,
        mapboxController: true,
        terrain: DefaultTerrain,
      })
      viewer.clock.multiplier = 1.5
      const points = [
        [100.652228194443055, 26.622640287833299],
        [100.652404121546255, 26.623005195836221],
        [100.652736909761231, 26.62336467943874],
        [100.653416352366875, 26.623699370052346],
        [100.653652077352476, 26.624405935907099],
        [100.654789103753714, 26.625546348774002],
        [100.655496278710558, 26.625930615763842],
        [100.655967728681787, 26.627194968998122],
        [100.656315249708413, 26.628339227605888],
        [100.658422908403367, 26.628983788005673],
        [100.660308708288298, 26.629578763609324],
        [100.666187966753171, 26.630074574245945],
        [100.672233619325539, 26.630272897898209],
        [100.673786630995508, 26.629777088122136],
        [100.674230348615509, 26.628091318791757],
        [100.675062319152971, 26.626455107130464],
        [100.675672430880468, 26.625314703331355],
        [100.677059048442942, 26.624818872043331],
        [100.67816834249291, 26.62229009901554],
        [100.679222171840365, 26.621546331595535],
        [100.680497859997843, 26.622141345918703],
        [100.680830648212847, 26.621100068820613],
        [100.681884477560331, 26.619761270042844],
        [100.685045965602754, 26.618819142985576],
        [100.687708271322677, 26.616339824156739],
        [100.687430947810185, 26.614257154791446],
        [100.688540241860181, 26.611678559210986],
        [100.690204182935133, 26.608851954948737],
        [100.688817565372659, 26.605380590983039],
        [100.689261282992632, 26.604239976971538],
        [100.689483141802654, 26.602801795268679],
        [100.689649535910135, 26.593428375112776],
        [100.688762100670147, 26.591692472307997],
        [100.688983959480154, 26.589609354190085],
        [100.691479871092582, 26.583062164744668],
        [100.691646265200106, 26.580086045773349],
        [100.688651171265178, 26.579242798002408],
        [100.688484777157669, 26.578101923488155],
        [100.68704269489271, 26.575720931371446],
        [100.686210724355234, 26.571454863380186],
        [100.687652806620207, 26.567635109563618],
        [100.689538606505167, 26.565353117949211],
        [100.688762100670147, 26.563765618718303],
        [100.689649535910135, 26.562624590062374],
        [100.688429312455156, 26.559548717098565],
        [100.68892849477767, 26.55806036183672],
        [100.687819200727674, 26.556075858092285],
        [100.688151988942693, 26.554289775348806],
        [100.687098159595223, 26.55304942373871],
        [100.686266189057719, 26.551560984093797],
        [100.68704269489271, 26.550618295658023],
        [100.688651171265192, 26.548782511725872],
        [100.688706635967662, 26.545904737229769],
        [100.687985594835197, 26.544416204844488],
        [100.688595706562666, 26.542629940481497],
        [100.687985594835197, 26.538709985074306],
        [100.686127527301494, 26.536129688161417],
        [100.684962768549028, 26.535087628727613],
        [100.684435853875272, 26.53451697312255],
        [100.68476864209029, 26.533648578712956],
        [100.68892849477767, 26.528661386437296],
        [100.689039424182681, 26.527098192010406],
        [100.687375483107715, 26.523922112369647],
        [100.686321653760245, 26.523376214831529],
        [100.686044330247725, 26.522532549894006],
        [100.687153624297707, 26.521465553005964],
        [100.687014962541468, 26.519877446251357],
        [100.687292286053975, 26.516725981867641],
        [100.685378753817744, 26.514244452985217],
        [100.685101430305238, 26.513251826418269],
        [100.681801280506576, 26.510050547293343],
        [100.681496224642842, 26.509181967801943],
        [100.682466856936557, 26.508189297484037],
        [100.683881206850302, 26.506328017517912],
        [100.68415853036278, 26.502729457410908],
        [100.683881206850302, 26.500260035443443],
        [100.683881206850302, 26.498646816556832],
        [100.682577786341568, 26.496115258192837],
        [100.680899979090981, 26.492454327627577],
        [100.679679755636016, 26.49134982059681],
        [100.679457896826008, 26.490170840708846],
        [100.678847785098512, 26.489202827130512],
        [100.678612060112926, 26.488669175134298],
        [100.675464438246109, 26.486373202247421],
        [100.672178154623055, 26.483704851833171],
        [100.671748303178674, 26.483593152093562],
        [100.671152057626813, 26.48320840771553],
        [100.670569678250587, 26.482774017354604],
        [100.6703616856162, 26.482302391676413],
        [100.670070495928087, 26.481719062504268],
        [100.669931834171848, 26.481172964427653],
        [100.670209157684354, 26.480068349027587],
        [100.669640644483749, 26.479137485116599],
        [100.668517484258118, 26.478603786409867],
        [100.667727112247519, 26.477697734097816],
        [100.666798078480682, 26.475922843817347],
        [100.665966107943177, 26.475612545501484],
        [100.665189602108185, 26.474123101934826],
        [100.664108040409459, 26.473043243291027],
        [100.661237742055178, 26.471193806668143],
        [100.659282611292099, 26.469977382482018],
        [100.657785064324614, 26.46917056342869],
        [100.656218186479009, 26.468674056584113],
        [100.654498780701573, 26.468549929538248],
        [100.653250824895352, 26.467954117854315],
        [100.652737776397231, 26.466923852872039],
        [100.652030601440373, 26.466303206864765],
        [100.651004504444145, 26.465272927103076],
        [100.650907441214784, 26.464565380238213],
        [100.650130935379778, 26.463448192121987],
        [100.649312831017937, 26.463063380371153],
        [100.648425395777949, 26.462926833956782],
        [100.647773685523603, 26.462591673889293],
        [100.647288369376739, 26.462591673889293],
        [100.646761454702983, 26.462827527371864],
        [100.646345469434266, 26.46317510004425],
        [100.64599881504364, 26.46365921737463],
        [100.645721491531148, 26.464031613935475],
        [100.645236175384284, 26.464354356646947],
        [100.644736993061784, 26.464515727663301],
        [100.64427940926619, 26.464503314516229],
        [100.643336509323717, 26.464441248760789],
        [100.64279572847434, 26.465099144065555],
        [100.642435207908107, 26.465893578666439],
        [100.642462940259321, 26.466514226882779],
        [100.642865059352445, 26.467470018589704],
        [100.643170115216193, 26.469133325489654],
        [100.643669297538693, 26.470362171115095],
        [100.643863423997431, 26.47094555787865],
        [100.644196212212407, 26.471615828381093],
        [100.644529000427411, 26.471988199195302],
        [100.644598331305573, 26.472695700422165],
        [100.645291640086796, 26.47368867726221],
        [100.645555097423667, 26.474247222968572],
        [100.645485766545519, 26.474718881675507],
        [100.645568963599302, 26.475066418432739],
        [100.645790822409296, 26.475811136520058],
        [100.64599881504364, 26.476071786711664],
        [100.645790822409296, 26.476444143103784],
        [100.644431937198078, 26.478281083664953],
        [100.644459669549306, 26.478616198035827],
        [100.644334873968674, 26.478914076656981],
        [100.643516769606833, 26.479633946806636],
        [100.64307305198686, 26.480465515336718],
        [100.642282679976262, 26.482141045605644],
        [100.641936025585622, 26.482724372637449],
        [100.641811230005032, 26.483717262908659],
        [100.641520040316905, 26.484722555574439],
        [100.641422977087501, 26.485603730806762],
        [100.640937660940637, 26.487403293050864],
        [100.640965393291893, 26.487874897808926],
        [100.641062456521269, 26.488222394813942],
        [100.641034724170041, 26.488780869943124],
        [100.64107632269689, 26.489935043280386],
        [100.641062456521269, 26.49031976515133],
        [100.641020857994405, 26.490704485734859],
        [100.641062456521269, 26.49101474333218],
        [100.641325913858168, 26.491213307755043],
        [100.64165870207313, 26.491771768355601],
        [100.641852828531881, 26.492404687089909],
        [100.642102419693146, 26.493186523068321],
        [100.642185616746886, 26.49368292410421],
        [100.642532271137483, 26.494092453345043],
        [100.642975988757499, 26.494514391036823],
        [100.643031453459983, 26.494824638351496],
        [100.643128516689359, 26.494985966624185],
        [100.64329491079684, 26.495680916594885],
        [100.642878925528123, 26.49623935549079],
        [100.643045319635604, 26.496859839970689],
        [100.643128516689359, 26.49721971943417],
        [100.643086918162496, 26.498200075015145],
        [100.642518404961891, 26.498646816556839],
        [100.641131787399416, 26.500346900433268],
        [100.640452344793815, 26.501488548482705],
        [100.640383013915667, 26.502146231883732],
        [100.640785133008791, 26.502704639363674],
        [100.641811230005032, 26.503374724757496],
        [100.641949891761257, 26.503709765988965],
        [100.642282679976262, 26.504342618982871],
        [100.642338144678746, 26.50482656303798],
        [100.642546137313118, 26.505583497087894],
        [100.642726397596235, 26.506514146871545],
        [100.642934390230607, 26.507060124569204],
        [100.64307305198686, 26.50739515505358],
        [100.643031453459983, 26.507829452375432],
        [100.643253312269991, 26.508214114346526],
        [100.64329491079684, 26.50885935088953],
        [100.642767996123126, 26.509603850089498],
        [100.642532271137483, 26.51026148703578],
        [100.642657066718115, 26.510770222467929],
        [100.642962122581864, 26.511626381888885],
        [100.643433572553093, 26.512544574755402],
        [100.643766360768069, 26.513028484258399],
        [100.643946621051214, 26.513636470231074],
        [100.643821825470596, 26.51420722964378],
        [100.643807959294961, 26.515460408837718],
        [100.643613832836223, 26.516490238928924],
        [100.64314238286498, 26.517544874631191],
        [100.642865059352488, 26.518599500647401],
        [100.642684799069343, 26.519195049883024],
        [100.641852828531881, 26.519902260588321],
        [100.640549408023134, 26.521391110992546],
        [100.639287586041306, 26.522954383137755],
        [100.638483347855058, 26.524592073982145],
        [100.638067362586341, 26.525435723784057],
        [100.638067362586341, 26.525745887593605],
        [100.637887102303196, 26.526279367385609],
        [100.637706842020108, 26.527085785620283],
        [100.637762306722593, 26.527482789439254],
        [100.637914834654453, 26.5277309161288],
        [100.637998031708193, 26.528115511437541],
        [100.638219890518187, 26.528500105457589],
        [100.63860814343569, 26.528921916771935],
        [100.638830002245669, 26.529343726536045],
        [100.638982530177586, 26.529703504227449],
        [100.638954797826329, 26.530013656504487],
        [100.638913199299438, 26.530596740516192],
        [100.639176656636295, 26.530981326221692],
        [100.639440113973194, 26.531353504709578],
        [100.639564909553783, 26.531899364308476],
        [100.639620374256296, 26.532395598054357],
        [100.639828366890683, 26.532693337271876],
        [100.640188887456901, 26.532966264209318],
        [100.640410746266923, 26.53335084197392],
        [100.640355281564396, 26.533698201427676],
        [100.640493943320649, 26.534107588005412],
        [100.640258218335035, 26.534665840075743],
        [100.640272084510656, 26.534913951235207],
        [100.640202753632536, 26.535261305957132],
        [100.63993929629568, 26.535447388411328],
        [100.639495578675678, 26.536129688161417],
        [100.638830002245669, 26.537184143430881],
        [100.638344686098804, 26.538461882123638],
        [100.638178291991338, 26.539355050234967],
        [100.638414016976952, 26.54014897160727],
        [100.63927371986567, 26.541389462751738],
        [100.639384649270667, 26.542146155762598],
        [100.639689705134415, 26.542865629733573],
        [100.639745169836928, 26.543907618518261],
        [100.640188887456901, 26.544552654450762],
        [100.641339780033746, 26.546586974783143],
        [100.641630969721859, 26.547591717244618],
        [100.641145653574995, 26.550655507190569],
        [100.641464575614336, 26.551002814245372],
        [100.641880560883081, 26.551585791579551],
        [100.641589371194982, 26.552255591666029],
        [100.641464575614336, 26.553520758931306],
        [100.641533906492484, 26.554091319992946],
        [100.64174189912687, 26.554401406335508],
        [100.641672568248723, 26.554699088435303],
        [100.641728032951193, 26.555288248645684],
        [100.641715900047529, 26.555570424305682],
        [100.641589371194968, 26.555922367699448],
        [100.641535639764413, 26.556044849948666],
        [100.641273915699486, 26.556443303955383],
        [100.641218450997002, 26.556559584046465],
        [100.641149120118854, 26.556742531151013],
        [100.64110925486392, 26.556947183498245],
        [100.641102321776131, 26.557179742540242],
        [100.641010458362615, 26.557556487187],
        [100.640856197158797, 26.557947184031349],
        [100.640681136691512, 26.558196795206957],
        [100.640603139453631, 26.558382840450133],
        [100.64055634111088, 26.55859059061482],
        [100.640578873646277, 26.558689814441202],
        [100.640622205445126, 26.558827797431992],
        [100.640641271436593, 26.558939423999636],
        [100.640523408943793, 26.559275853414004],
        [100.640400346635133, 26.559548717098565],
        [100.64038821373147, 26.559680497622701],
        [100.640424612442487, 26.559810727638887],
        [100.640400346635133, 26.559940957507099],
        [100.640246085431301, 26.560272732931239],
        [100.640131689482402, 26.560413814713112],
        [100.639953162471215, 26.560553345974913],
        [100.639833566706486, 26.560719232920704],
        [100.639672372414836, 26.560939381580813],
        [100.639485179043888, 26.561407583663215],
        [100.639396782174316, 26.561686643597294],
        [100.639327451296197, 26.561812220345946],
        [100.639140257925263, 26.562125386453022],
        [100.639039728151985, 26.562368787242267],
        [100.638985996721431, 26.562550174755412],
        [100.638951331282371, 26.562801326222747],
        [100.638959997642132, 26.562992014932203],
        [100.639013729072659, 26.563286574103678],
        [100.638992929809234, 26.563576481601597],
        [100.639008529256827, 26.564768660341031],
        [100.639048394511718, 26.565053913233072],
        [100.639119458661824, 26.565453886201055],
        [100.639131591565501, 26.565610464385795],
        [100.639204388987508, 26.566060044123173],
        [100.639225188250961, 26.566326690582351],
        [100.639282386225418, 26.566658447519927],
        [100.639306652032744, 26.567185536006125],
        [100.639296252401053, 26.567619607056518],
        [100.639277186409529, 26.568013370086884],
        [100.639166257004547, 26.568483093506682],
        [100.639119458661824, 26.568653619684273],
        [100.639015462344616, 26.568999321974584],
        [100.638975597089711, 26.569267511822112],
        [100.638975597089711, 26.569462840448882],
        [100.638999862897066, 26.569613212260094],
        [100.639011995800729, 26.56969382387144],
        [100.638965197457978, 26.569842645158761],
        [100.638791870262665, 26.57046118156271],
        [100.638651475234497, 26.571168076220939],
        [100.638606410163717, 26.571583529818319],
        [100.63859427726004, 26.571783505079914],
        [100.638615076523479, 26.571881167290101],
        [100.63866360813816, 26.571966427881716],
        [100.638776270815086, 26.572064089935953],
        [100.638998129625108, 26.572212908144216],
        [100.639287586041249, 26.572369477092145],
        [100.639412381621881, 26.572482640653948],
        [100.639459179964632, 26.572575651716935],
        [100.639447047060941, 26.572625257586324],
        [100.639577042457447, 26.573063958558624],
        [100.639571842641573, 26.573127515803979],
        [100.639509444851257, 26.573539861953812],
        [100.639528510842752, 26.573609619614327],
        [100.63958397554525, 26.573736733464248],
        [100.639611707896506, 26.573874698336841],
        [100.639705304581966, 26.574065368617585],
        [100.639731303661264, 26.574158378395456],
        [100.639831833434528, 26.574324245645233],
        [100.639960095559061, 26.57447151075916],
        [100.640057158788437, 26.574592423026957],
        [100.640124756394627, 26.5747319370235],
        [100.640175021281237, 26.574824946260115],
        [100.640188887456873, 26.57494585815482],
        [100.640218353080087, 26.57522178482116],
        [100.640263418150838, 26.575432604747505],
        [100.640265151422795, 26.575631023147231],
        [100.640227019439848, 26.575840292180761],
        [100.64023568579961, 26.575920899410196],
        [100.640227019439862, 26.576079013426238],
        [100.640258218335021, 26.576827726832359],
        [100.640325815941182, 26.57698273934836],
        [100.640428078986403, 26.577100548720207],
        [100.640502609680368, 26.577170304212206],
        [100.640499143136466, 26.577277262550755],
        [100.6405390083914, 26.577384220789419],
        [100.640618738901253, 26.577491178928195],
        [100.64069153632326, 26.577548533251328],
        [100.640773000105071, 26.577615188239417],
        [100.640883929510068, 26.57779035116274],
        [100.640979259467471, 26.577914360150018],
        [100.641083255784679, 26.578036818893192],
        [100.641209784637255, 26.578210431064175],
        [100.6412444500763, 26.578328239173157],
        [100.641611903730364, 26.578735916299241],
        [100.641755765302463, 26.578892476330815],
        [100.641861494891629, 26.579073837683961],
        [100.641981090656358, 26.579190094810571],
        [100.642111086052836, 26.579362155141339],
        [100.642157884395573, 26.579421058618617],
        [100.6422133490981, 26.579534215213613],
        [100.642246281265187, 26.579577617713532],
        [100.64229654615184, 26.57961481984324],
        [100.642591202383855, 26.579830281940048],
        [100.642670932893708, 26.579918636783411],
        [100.642714264692515, 26.579986840475513],
        [100.64273333068401, 26.580104646757128],
        [100.642741997043771, 26.580239503799149],
        [100.642769729395027, 26.580348009349844],
        [100.642832127185315, 26.580453414643497],
        [100.642868525896347, 26.580555719688682],
        [100.642873725712207, 26.580634773524636],
        [100.642813061193863, 26.580743278700801],
        [100.642691732157118, 26.580893635703543],
        [100.642625867822915, 26.580994390285642],
        [100.642584269296066, 26.581098244915932],
        [100.642579069480206, 26.581254801717911],
        [100.642632800910746, 26.581549313933664],
        [100.642683065797371, 26.58169656975749],
        [100.642825194097526, 26.581966279933216],
        [100.642899724791505, 26.582158486797223],
        [100.642899724791505, 26.582265440476988],
        [100.64288412534394, 26.58238789456739],
        [100.642684799069343, 26.582693254197054],
        [100.642629334366859, 26.582829658235504],
        [100.642629334366859, 26.582887009884967],
        [100.642570403120445, 26.583021863650238],
        [100.642534004409413, 26.58321406874234],
        [100.642598135471701, 26.583500825739662],
        [100.642683065797399, 26.58366357939164],
        [100.642719464508389, 26.583987535972273],
        [100.642688265613231, 26.584379692711941],
        [100.642632800910746, 26.585284903140494],
        [100.642771462667014, 26.585991706307478],
        [100.642799195018242, 26.586884504070799],
        [100.642632800910746, 26.587826894156436],
        [100.642674399437638, 26.588186488328446],
        [100.642743730315757, 26.589228065072945],
        [100.642591202383898, 26.589922444304126],
        [100.642216815642001, 26.591162396740113],
        [100.642147484763882, 26.592166748366811],
        [100.642189083290774, 26.592687519814731],
        [100.642785328842649, 26.5935554669623],
        [100.643187447935759, 26.59413822778227],
        [100.64353410232637, 26.594720985634822],
        [100.643603433204476, 26.595303740519924],
        [100.643755961136378, 26.596816409564301],
        [100.644019418473235, 26.59718837429914],
        [100.645003916942585, 26.598143078250914],
        [100.645308972806333, 26.598911795124391],
        [100.645822021304411, 26.600027665267355],
        [100.646321203626911, 26.600821166303671],
        [100.64713930798878, 26.60158986518465],
        [100.64745823002815, 26.602271771159302],
        [100.64827633438999, 26.606164756518538],
        [100.648442728497486, 26.606462304089568],
        [100.648609122605009, 26.607317749044775],
        [100.648428862321865, 26.608173187602215],
        [100.648650721131858, 26.608830259251064],
        [100.648678453483114, 26.609437737228529],
        [100.648858713766231, 26.609933635226223],
        [100.649510424020619, 26.610479120540209],
        [100.650009606343076, 26.611483302610157],
        [100.65032852838246, 26.612202341144087],
        [100.650730647475569, 26.612908978057106],
        [100.650883175407429, 26.613863550812983],
        [100.65124369597369, 26.61548754589187],
        [100.651410090081185, 26.617024741357969],
        [100.652061800335517, 26.619156946014002],
        [100.652200462091798, 26.621809749776837],
        [100.652228194443055, 26.622640287833299],
      ]
      const positions = points.map((ele) =>
        Cesium.Cartographic.fromDegrees(
          ele[0],
          ele[1],
          1480 + 5 * Math.random()
        )
      )

      const waterReflect = viewer.Layers.Add.addWaterReflection({
        scene: viewer.scene,
        positions: positions,
        height: 1480,
        rippleSize: 50,
      })

      const gui = new dat.GUI({ autoPlace: false })
      const customContainer = document.getElementById("gui-box")
      customContainer.appendChild(gui.domElement)

      const waterParams = {
        message: "GUI面板-动态水面倒影",
        波纹大小: 50.0,
        水面透明度: 0.9,
        水面反射率: 0.3,
        水面扭曲强度: 3.7,
        水面高度: 1480,
        x: 0.0,
        y: 0.0,
        z: 1.0,
        太阳高光强度: 100.0,
        盒子大小: 50,
        盒子移动速度: 3.0,
        盒子颜色: "#42A5F5",
        显示盒子: true,
        水体颜色: "#00aeff",
      }
      function waterParamsUpdate() {
        waterReflect.rippleSize = waterParams["波纹大小"]
        waterReflect.waterAlpha = waterParams["水面透明度"]
        waterReflect.reflectivity = waterParams["水面反射率"]
        waterReflect.distortionScale = waterParams["水面扭曲强度"]
        waterReflect.waterColor = waterParams["水体颜色"]
        waterReflect.height = waterParams["水面高度"]
        const { x, y, z } = waterParams
        waterReflect.lightDirection = { x, y, z }
        waterReflect.sunShiny = waterParams["太阳高光强度"]
        const size = waterParams["盒子大小"]
        if (floatingBox) {
          floatingBox.box.dimensions = new Cesium.Cartesian3(size, size, size)

          let color = Cesium.Color.fromCssColorString(waterParams["盒子颜色"])
          floatingBox.box.material = color.withAlpha(0.8)

          floatingBox.show = waterParams["显示盒子"]
        }
      }
      gui.add(waterParams, "message")
      gui
        .add(waterParams, "波纹大小")
        .min(0)
        .max(300)
        .onChange(waterParamsUpdate)
      gui
        .add(waterParams, "水面透明度")
        .min(0)
        .max(1)
        .onChange(waterParamsUpdate)
      gui
        .add(waterParams, "水面反射率")
        .min(0)
        .max(1)
        .onChange(waterParamsUpdate)
      gui
        .add(waterParams, "水面扭曲强度")
        .min(0)
        .max(8)
        .onChange(waterParamsUpdate)
      gui.addColor(waterParams, "水体颜色").onChange(waterParamsUpdate)

      gui
        .add(waterParams, "水面高度")
        .min(1470)
        .max(1520)
        .onChange(waterParamsUpdate)

      const lightDir = gui.addFolder("光照方向")
      lightDir.open()
      lightDir
        .add(waterParams, "x")
        .min(-1)
        .max(1)
        .step(0.1)
        .onChange(waterParamsUpdate)
      lightDir
        .add(waterParams, "y")
        .min(-1)
        .max(1)
        .step(0.1)
        .onChange(waterParamsUpdate)
      lightDir
        .add(waterParams, "z")
        .min(-1)
        .max(1)
        .step(0.1)
        .onChange(waterParamsUpdate)
      gui
        .add(waterParams, "太阳高光强度")
        .min(1)
        .max(100)
        .onChange(waterParamsUpdate)

      const boxFolder = gui.addFolder("Floating Box")
      boxFolder
        .add(waterParams, "盒子大小")
        .min(30)
        .max(80)
        .onChange(waterParamsUpdate)
      boxFolder.add(waterParams, "盒子移动速度").min(0.1).max(3)
      boxFolder.addColor(waterParams, "盒子颜色").onChange(waterParamsUpdate)
      boxFolder.add(waterParams, "显示盒子").onChange(waterParamsUpdate)

      let ellipsoid = viewer.entities.add({
        position: Cesium.Cartesian3.fromDegrees(100.66438, 26.56388, 1600),
        ellipsoid: {
          radii: new Cesium.Cartesian3(100, 100, 100),
          outline: true,
          outlineColor: Cesium.Color.BLACK,
          material: Cesium.Color.YELLOW,
          classificationType: Cesium.ClassificationType.BOX,
        },
      })

      let floatingBox = viewer.entities.add({
        name: "Floating Box",
        position: new Cesium.CallbackProperty(function (time) {
          let longitude = 100.66938
          let latitude = 26.56588
          let waterHeight = waterParams["水面高度"]

          let seconds = Cesium.JulianDate.secondsDifference(
            time,
            Cesium.JulianDate.fromDate(new Date())
          )
          let speed = waterParams["盒子移动速度"]

          let verticalOffset = 3 * Math.sin(seconds * speed)

          let horizontalOffset_x = 2 * Math.sin(seconds * speed * 0.3)
          let horizontalOffset_y = 2 * Math.cos(seconds * speed * 0.4)
          const curPos = Cesium.Cartesian3.fromDegrees(
            longitude + horizontalOffset_x * 0.0001,
            latitude + horizontalOffset_y * 0.0001,
            waterHeight + 2 + verticalOffset
          )
          return curPos
        }, false),
        box: {
          dimensions: new Cesium.Cartesian3(
            waterParams["盒子大小"],
            waterParams["盒子大小"],
            waterParams["盒子大小"]
          ),
          material: Cesium.Color.fromCssColorString(
            waterParams["盒子颜色"]
          ).withAlpha(0.8),
          outline: true,
          outlineColor: Cesium.Color.BLACK,
        },
        show: waterParams["显示盒子"],
      })

      viewer.scene.preUpdate.addEventListener(function (scene, time) {
        if (floatingBox && floatingBox.show) {
          let seconds = Cesium.JulianDate.secondsDifference(
            time,
            Cesium.JulianDate.fromDate(new Date())
          )
          let rotationSpeed = waterParams["盒子移动速度"] * 0.3

          floatingBox.orientation = Cesium.Quaternion.fromHeadingPitchRoll(
            new Cesium.HeadingPitchRoll(
              seconds * rotationSpeed,
              seconds * rotationSpeed * 0.7,
              seconds * rotationSpeed * 0.5
            )
          )
        }
      })

      viewer.flyTo([ellipsoid, floatingBox], {
        duration: 1,
        offset: {
          heading: Cesium.Math.toRadians(90.0),
          pitch: Cesium.Math.toRadians(-25),
          range: 2500,
        },
      })
    </script>
  </body>
</html>
