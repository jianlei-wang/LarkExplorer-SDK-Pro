<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>007-添加点</title>
    <script src="./Cesium/Cesium.js"></script>
    <link rel="stylesheet" href="./Cesium/Widgets/widgets.css" />
    <script src="./lib/larkexplorer.umd.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
      #cesiumContainer {
        width: 100%;
        height: 100%;
        position: relative;
      }
      #gui-box {
        position: absolute;
        left: 5px;
        top: 5px;
        z-index: 99;
      }
    </style>
  </head>
  <body>
    <div id="cesiumContainer">
      <div id="gui-box"></div>
    </div>
    <script>
      const { DefaultTdtImg, DefaultTerrain } = LarkExplorer.BaseLayer
      const viewer = new LarkExplorer.Viewer("cesiumContainer", {
        baseLayer: DefaultTdtImg,
        fpsShow: true,
        mapboxController: true,
        terrain: DefaultTerrain,
      })
      initGui()
      function getRandomColor() {
        const letters = "0123456789ABCDEF"
        let color = "#"
        for (let i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 16)]
        }
        return color
      }
      function pointGraphics() {
        const pColor = getRandomColor()
        const pOutlineColor = getRandomColor()
        const pixelSize = Math.ceil(5 + Math.random() * 20)
        const outlineWidth = Math.ceil(pixelSize / 3)
        console.log(pColor, pOutlineColor)
        const onGround = false
        const pg = new LarkExplorer.PointGraphics({
          pColor,
          pixelSize,
          pOutlineColor,
          outlineWidth,
          onGround,
        })
        console.log(pg.value)
        return pg.value
      }
      function positionRandom() {
        const preX = Math.random() > 0.5 ? 1 : -1
        const x = 120 + Math.random() * preX * 2
        const preY = Math.random() > 0.5 ? 1 : -1
        const y = 30 + Math.random() * preY * 2
        const z = 0
        return LarkExplorer.Coordinates.transformWGS84ToCartesian({ x, y, z })
      }
      let pointPrimitive
      async function addPrimitive() {
        const option = pointGraphics()
        const position = positionRandom()
        pointPrimitive = await viewer.Layers.Add.addPointPrimitive(
          position,
          option
        )
      }
      function removePrimitive() {
        viewer.Layers.remove(pointPrimitive)
      }
      let pointPrimitives
      async function addPrimitives() {
        const options = Array.from({ length: 100 }, () => pointGraphics())
        const points = Array.from({ length: 100 }, () => positionRandom())
        pointPrimitives = await viewer.Layers.Add.addPointPrimitives(
          points,
          options
        )
      }
      function removePrimitives() {
        viewer.Layers.remove(pointPrimitives)
      }
      let pointEntity
      function addEntity() {
        const option = pointGraphics()
        const position = positionRandom()
        pointEntity = viewer.Layers.Add.addPointEntity(position, option)
      }
      function removeEntity() {
        viewer.Layers.remove(pointEntity)
      }
      let pointEntities
      function addEntities() {
        const options = Array.from({ length: 475 }, () => pointGraphics())
        const points = Array.from({ length: 475 }, () => positionRandom())
        pointEntities = viewer.Layers.Add.addPointEntities(points, options)
      }
      function removeEntities() {
        viewer.Layers.remove(pointEntities)
      }
      function initGui() {
        const params = {
          message: "GUI面板-添加点",
          "单个点(Primitive)": false,
          "多点(Primitive)": false,
          "单个点(Entity)": false,
          "多点(Entity)": false,
        }
        const gui = new dat.GUI({ autoPlace: false })
        const customContainer = document.getElementById("gui-box")
        customContainer.appendChild(gui.domElement)
        gui.add(params, "message")
        const boolPrimitive = gui.add(params, "单个点(Primitive)")
        boolPrimitive.onFinishChange((bool) => {
          bool ? addPrimitive() : removePrimitive()
        })
        const boolPrimitives = gui.add(params, "多点(Primitive)")
        boolPrimitives.onFinishChange((bool) => {
          bool ? addPrimitives() : removePrimitives()
        })
        const boolEntity = gui.add(params, "单个点(Entity)")
        boolEntity.onFinishChange((bool) => {
          bool ? addEntity() : removeEntity()
        })
        const boolEntities = gui.add(params, "多点(Entity)")
        boolEntities.onFinishChange((bool) => {
          bool ? addEntities() : removeEntities()
        })
      }
    </script>
  </body>
</html>
